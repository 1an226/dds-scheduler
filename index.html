<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDS Ordering Desk Scheduler</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --rift: #e74c3c;
            --central: #3498db;
            --d2: #2ecc71;
            --d3: #f39c12;
            --off: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 10px 10px 0 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .user-info {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 5px;
            text-align: right;
            margin-top: 10px;
        }
        
        .nav-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .week-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        
        .btn-success {
            background-color: var(--success);
        }
        
        .btn-warning {
            background-color: var(--warning);
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .analytics-btn {
            background-color: var(--success);
        }
        
        .logout-btn {
            background-color: var(--danger);
        }
        
        .week-display {
            font-weight: bold;
            font-size: 18px;
        }

        /* Admin Controls */
        .admin-controls {
            background-color: #e8f6f3;
            border-left: 4px solid var(--success);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        
        .admin-controls h3 {
            color: var(--success);
            margin-bottom: 10px;
        }

        /* Schedule Table */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .schedule-table th {
            background-color: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
            border: 1px solid #ddd;
        }
        
        .schedule-table td {
            padding: 15px;
            border: 1px solid #ddd;
            text-align: center;
        }
        
        .user-cell {
            font-weight: bold;
            background: #f8f9fa;
        }
        
        .current-user {
            background-color: #e8f4fc;
        }
        
        /* Shift Colors */
        .shift-rift { background-color: var(--rift); color: white; font-weight: bold; }
        .shift-central { background-color: var(--central); color: white; font-weight: bold; }
        .shift-d2 { background-color: var(--d2); color: white; font-weight: bold; }
        .shift-d3 { background-color: var(--d3); color: white; font-weight: bold; }
        .shift-off { background-color: var(--off); color: white; font-weight: bold; }
        .shift-leave { background-color: #fff9e6; color: var(--warning); font-weight: bold; }
        
        .on-leave {
            color: #95a5a6;
            font-style: italic;
        }
        
        .team-updates {
            background-color: #fff9e6;
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 5px 5px 0;
        }
        
        /* Login Styles */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .login-btn {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
        }
        
        .demo-note {
            margin-top: 20px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        /* Analytics Modal */
        .analytics-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .analytics-modal.active {
            display: flex;
        }
        
        .analytics-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .close-btn:hover {
            color: var(--danger);
        }
        
        .metric {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }
        
        .metric-label {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary);
        }

        .locked-banner {
            background-color: var(--warning);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .date-range {
            font-size: 16px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <h1>DDS Ordering Desk Scheduler</h1>
        <div class="subtitle">Please login to continue</div>
        
        <div class="login-form">
            <div class="form-group">
                <label for="userSelect">Select User:</label>
                <select id="userSelect">
                    <option value="">-- Choose User --</option>
                    <option value="Ian">Ian (Admin)</option>
                    <option value="Kim">Kim</option>
                    <option value="Emma">Emma</option>
                    <option value="Kevo">Kevo</option>
                    <option value="Wendy">Wendy</option>
                    <option value="Janet">Janet</option>
                </select>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            
            <div id="errorMessage" class="error-message hidden"></div>
            
            <button class="login-btn" onclick="login()">Login</button>
        </div>
        
        <div class="demo-note">
            <strong>Demo Access:</strong> Use default passwords
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container hidden">
        <header>
            <h1>DDS Ordering Desk Scheduler</h1>
            <div class="subtitle">Weekly Duty Roster Management</div>
            <div class="user-info">
                <div id="loggedInUser">User</div>
                <div id="userStatus">Status</div>
            </div>
        </header>
        
        <!-- Admin Controls (only for Ian) -->
        <div id="adminControls" class="admin-controls hidden">
            <h3>Admin Controls</h3>
            <p>You can lock/unlock the roster and export data</p>
            <button class="btn btn-success" onclick="lockRoster()">Lock Roster</button>
            <button class="btn btn-warning" onclick="unlockRoster()">Unlock Roster</button>
            <button class="btn btn-danger" onclick="downloadJSON()">Export JSON</button>
            <button class="btn analytics-btn" onclick="showAnalytics()">Team Analytics</button>
        </div>

        <!-- Locked Banner -->
        <div id="lockedBanner" class="locked-banner hidden">
            ðŸ”’ Roster Locked - View Only Mode
        </div>
        
        <div class="nav-controls">
            <div class="week-nav">
                <button class="btn">&lt; Previous</button>
                <div>
                    <div class="week-display">Week 41, 2025</div>
                    <div class="date-range">6th Oct - 12th Oct 2025</div>
                </div>
                <button class="btn">Next &gt;</button>
            </div>
            <div>
                <button class="btn analytics-btn" onclick="showAnalytics()" id="userAnalyticsBtn">My Analytics</button>
                <button class="btn logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
        
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Monday<br>6th Oct</th>
                    <th>Tuesday<br>7th Oct</th>
                    <th>Wednesday<br>8th Oct</th>
                    <th>Thursday<br>9th Oct</th>
                    <th>Friday<br>10th Oct</th>
                    <th>Saturday<br>11th Oct</th>
                    <th>Sunday<br>12th Oct</th>
                </tr>
            </thead>
            <tbody id="scheduleBody">
                <!-- Filled by JavaScript -->
            </tbody>
        </table>
        
        <div class="team-updates">
            <h3>Team Updates</h3>
            <p>Emma is on leave from Wednesday until February 2026 - Janet returns on Saturday</p>
            <p><strong>TPC - Mostly sunny</strong></p>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="analytics-modal">
        <div class="analytics-content">
            <button class="close-btn" onclick="hideAnalytics()">&times;</button>
            <h2 id="analyticsTitle">User Analytics</h2>
            <div id="analyticsContent">
                <!-- Analytics content -->
            </div>
        </div>
    </div>

    <script>
        // User credentials
        const userCredentials = {
            'Ian': 'OFtFusGT',
            'Kim': 'Monday',
            'Emma': 'Tuesday',
            'Kevo': 'Sunday',
            'Wendy': 'Saturday',
            'Janet': 'Friday'
        };

        // Schedule data with PROPER COLORS
        const scheduleData = {
            'Ian': ['Rift', 'Central', 'D2', 'Rift', 'D3', 'Central', 'D3'],
            'Kim': ['OFF', 'D3', 'Central', 'D2', 'Rift', 'D3', 'Central'],
            'Emma': ['D3', 'OFF', 'Leave', 'Leave', 'Leave', 'Leave', 'Leave'],
            'Kevo': ['D2', 'Rift', 'D3', 'Central', 'D2', 'Rift', 'OFF'],
            'Wendy': ['Central', 'D2', 'Rift', 'D3', 'Central', 'OFF', 'D2'],
            'Janet': ['OFF', 'OFF', 'OFF', 'OFF', 'OFF', 'D2', 'Rift']
        };

        const users = ['Ian', 'Kim', 'Emma', 'Kevo', 'Wendy', 'Janet'];
        let currentUser = '';
        let isRosterLocked = true; // Default to locked

        function initializePage() {
            checkLogin();
            updateLockedState();
        }

        function checkLogin() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                showMainApp();
            }
        }

        function showLoginPage() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            setupUserExperience();
            renderSchedule();
            updateLockedState();
        }

        function setupUserExperience() {
            const isAdmin = currentUser === 'Ian';
            
            document.getElementById('loggedInUser').textContent = 
                currentUser + (currentUser === 'Emma' ? ' (You)' : (isAdmin ? ' (Admin)' : ''));
            document.getElementById('userStatus').textContent = 
                currentUser === 'Emma' ? 'on leave until February 2026' : 'viewing roster';
            
            // Show admin controls only for Ian
            if (isAdmin) {
                document.getElementById('adminControls').classList.remove('hidden');
                document.getElementById('userAnalyticsBtn').textContent = 'Team Analytics';
            } else {
                document.getElementById('adminControls').classList.add('hidden');
                document.getElementById('userAnalyticsBtn').textContent = 'My Analytics';
            }
        }

        function updateLockedState() {
            const lockedBanner = document.getElementById('lockedBanner');
            if (isRosterLocked) {
                lockedBanner.classList.remove('hidden');
            } else {
                lockedBanner.classList.add('hidden');
            }
        }

        // Admin Functions
        function lockRoster() {
            isRosterLocked = true;
            updateLockedState();
            alert('Roster locked! All users now have view-only access.');
            downloadJSON(); // Automatically download JSON when locked
        }

        function unlockRoster() {
            isRosterLocked = false;
            updateLockedState();
            alert('Roster unlocked! Admin can now make changes.');
        }

        function downloadJSON() {
            // Create the JSON data structure
            const jsonData = {
                scheduleData: {
                    "Ian-Monday": "Rift",
                    "Kim-Monday": "OFF",
                    "Kevo-Monday": "D2",
                    "Emma-Monday": "D3",
                    "Wendy-Monday": "Central",
                    "Ian-Tuesday": "Central",
                    "Emma-Tuesday": "OFF",
                    "Kevo-Tuesday": "Rift",
                    "Wendy-Tuesday": "D2",
                    "Kevo-Wednesday": "D3",
                    "Wendy-Wednesday": "Rift",
                    "Kim-Wednesday": "Central",
                    "Emma-Wednesday": "Rift",
                    "Emma-Thursday": "D2",
                    "Ian-Thursday": "Rift",
                    "Kim-Thursday": "D2",
                    "Wendy-Thursday": "D3",
                    "Kevo-Thursday": "Central",
                    "Wendy-Friday": "Central",
                    "Emma-Friday": "OFF",
                    "Kevo-Friday": "D2",
                    "Kim-Friday": "Rift",
                    "Ian-Friday": "D3",
                    "Ian-Saturday": "Central",
                    "Kim-Sunday": "Central",
                    "Kevo-Sunday": "OFF",
                    "Ian-Sunday": "D3",
                    "Wendy-Sunday": "D2",
                    "Emma-Saturday": "D3",
                    "Emma-Sunday": "Central",
                    "Kim-Saturday": "D3",
                    "Kevo-Saturday": "Rift",
                    "Kim-Tuesday": "D3",
                    "Ian-Wednesday": "D2",
                    "Janet-Saturday": "D2",
                    "Janet-Sunday": "Rift"
                },
                isRosterLocked: isRosterLocked,
                currentWeek: 41,
                currentYear: 2025,
                dateRange: "6th Oct - 12th Oct 2025",
                lastSavedTime: new Date().toISOString(),
                updatedBy: currentUser
            };

            // Convert to JSON string
            const jsonString = JSON.stringify(jsonData, null, 2);
            
            // Create download link
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `roster_week41_2025_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('JSON file downloaded! You can now upload this to GitHub.');
        }

        function login() {
            const userSelect = document.getElementById('userSelect');
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const selectedUser = userSelect.value;
            
            errorMessage.classList.add('hidden');
            
            if (!selectedUser) {
                showError('Please select a user');
                return;
            }
            
            if (!password) {
                showError('Please enter password');
                return;
            }
            
            if (password === userCredentials[selectedUser]) {
                currentUser = selectedUser;
                localStorage.setItem('currentUser', currentUser);
                showMainApp();
            } else {
                showError('Invalid password');
            }
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function logout() {
            localStorage.removeItem('currentUser');
            showLoginPage();
        }

        function renderSchedule() {
            const scheduleBody = document.getElementById('scheduleBody');
            scheduleBody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                if (user === currentUser) row.classList.add('current-user');
                
                // Name cell
                const nameCell = document.createElement('td');
                nameCell.className = 'user-cell';
                if (user === 'Emma') {
                    nameCell.innerHTML = user + ' <span class="on-leave">(on leave)</span>';
                } else if (user === 'Janet') {
                    nameCell.innerHTML = user + ' <span class="on-leave">(returns Saturday)</span>';
                } else {
                    nameCell.textContent = user;
                }
                row.appendChild(nameCell);
                
                // Shift cells with PROPER COLORS
                scheduleData[user].forEach(shift => {
                    const cell = document.createElement('td');
                    
                    if (shift === 'Rift') cell.className = 'shift-rift';
                    else if (shift === 'Central') cell.className = 'shift-central';
                    else if (shift === 'D2') cell.className = 'shift-d2';
                    else if (shift === 'D3') cell.className = 'shift-d3';
                    else if (shift === 'OFF') cell.className = 'shift-off';
                    else if (shift === 'Leave') cell.className = 'shift-leave';
                    
                    cell.textContent = shift;
                    row.appendChild(cell);
                });
                
                scheduleBody.appendChild(row);
            });
        }

        function showAnalytics() {
            const modal = document.getElementById('analyticsModal');
            const title = document.getElementById('analyticsTitle');
            const content = document.getElementById('analyticsContent');
            
            if (currentUser === 'Ian') {
                title.textContent = 'Team Analytics - Admin View';
                content.innerHTML = generateTeamAnalytics();
            } else {
                title.textContent = currentUser + "'s Analytics";
                content.innerHTML = generateUserAnalytics(currentUser);
            }
            
            modal.classList.add('active');
        }

        function hideAnalytics() {
            document.getElementById('analyticsModal').classList.remove('active');
        }

        function generateUserAnalytics(user) {
            const shifts = scheduleData[user];
            const workingDays = shifts.filter(s => !['OFF', 'Leave'].includes(s)).length;
            const offDays = shifts.filter(s => s === 'OFF').length;
            const leaveDays = shifts.filter(s => s === 'Leave').length;
            
            return `
                <div class="metric">
                    <div class="metric-label">Working Days</div>
                    <div class="metric-value">${workingDays}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">OFF Days</div>
                    <div class="metric-value">${offDays}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Leave Days</div>
                    <div class="metric-value">${leaveDays}</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Total Scheduled</div>
                    <div class="metric-value">${workingDays + offDays + leaveDays} days</div>
                </div>
            `;
        }

        function generateTeamAnalytics() {
            let html = '';
            
            users.forEach(user => {
                const shifts = scheduleData[user];
                const workingDays = shifts.filter(s => !['OFF', 'Leave'].includes(s)).length;
                
                html += `
                    <div class="metric">
                        <div class="metric-label">${user}</div>
                        <div class="metric-value">${workingDays} working days</div>
                    </div>
                `;
            });
            
            return html;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', initializePage);

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') hideAnalytics();
        });

        // Close modal when clicking outside
        document.getElementById('analyticsModal').addEventListener('click', function(e) {
            if (e.target === this) hideAnalytics();
        });

        // Enter key to login
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>
